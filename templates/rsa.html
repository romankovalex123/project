{% extends "base.html" %}

{% block title %}RSA –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ{% endblock %}

{% block content %}
<div class="container">
    <h1>üîë RSA –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</h1>

    <div class="theory-section">
        <h2>üìñ –¢–µ–æ—Ä–∏—è RSA</h2>
        <div class="theory-content">
            <p><strong>RSA</strong> - –æ–¥–∏–Ω –∏–∑ –ø–µ—Ä–≤—ã—Ö –∞—Å–∏–º–º–µ—Ç—Ä–∏—á–Ω—ã—Ö –∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –∞–ª–≥–æ—Ä–∏—Ç–º–æ–≤, –Ω–∞–∑–≤–∞–Ω–Ω—ã–π –≤ —á–µ—Å—Ç—å –µ–≥–æ —Å–æ–∑–¥–∞—Ç–µ–ª–µ–π: –†–∏–≤–µ—Å—Ç–∞, –®–∞–º–∏—Ä–∞ –∏ –ê–¥–ª–µ–º–∞–Ω–∞ (1977).</p>

            <h3>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å–Ω–æ–≤–∞:</h3>
            <p>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å RSA –æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ <strong>—Å–ª–æ–∂–Ω–æ—Å—Ç–∏ —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª</strong>. –õ–µ–≥–∫–æ –ø–µ—Ä–µ–º–Ω–æ–∂–∏—Ç—å –¥–≤–∞ –±–æ–ª—å—à–∏—Ö –ø—Ä–æ—Å—Ç—ã—Ö —á–∏—Å–ª–∞, –Ω–æ –∫—Ä–∞–π–Ω–µ —Å–ª–æ–∂–Ω–æ —Ä–∞–∑–ª–æ–∂–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –æ–±—Ä–∞—Ç–Ω–æ –Ω–∞ –º–Ω–æ–∂–∏—Ç–µ–ª–∏.</p>

            <h3>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π:</h3>
            <div class="algorithm-steps">
                <div class="step">
                    <span class="step-number">1</span>
                    <div class="step-content">
                        <strong>–í—ã–±–æ—Ä –ø—Ä–æ—Å—Ç—ã—Ö —á–∏—Å–µ–ª:</strong> p –∏ q
                    </div>
                </div>
                <div class="step">
                    <span class="step-number">2</span>
                    <div class="step-content">
                        <strong>–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –º–æ–¥—É–ª—è:</strong> n = p √ó q
                    </div>
                </div>
                <div class="step">
                    <span class="step-number">3</span>
                    <div class="step-content">
                        <strong>–§—É–Ω–∫—Ü–∏—è –≠–π–ª–µ—Ä–∞:</strong> œÜ(n) = (p-1)(q-1)
                    </div>
                </div>
                <div class="step">
                    <span class="step-number">4</span>
                    <div class="step-content">
                        <strong>–ü—É–±–ª–∏—á–Ω–∞—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞:</strong> e (–≤–∑–∞–∏–º–Ω–æ –ø—Ä–æ—Å—Ç–æ–µ —Å œÜ(n))
                    </div>
                </div>
                <div class="step">
                    <span class="step-number">5</span>
                    <div class="step-content">
                        <strong>–ü—Ä–∏–≤–∞—Ç–Ω–∞—è —ç–∫—Å–ø–æ–Ω–µ–Ω—Ç–∞:</strong> d = e‚Åª¬π mod œÜ(n)
                    </div>
                </div>
            </div>

            <h3>–§–æ—Ä–º—É–ª—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è:</h3>
            <div class="math-formulas">
                <div class="formula-card">
                    <h4>–®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</h4>
                    <div class="formula">c = m<sup>e</sup> mod n</div>
                    <p>–≥–¥–µ m - –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, c - —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç</p>
                </div>
                <div class="formula-card">
                    <h4>–î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</h4>
                    <div class="formula">m = c<sup>d</sup> mod n</div>
                    <p>–≥–¥–µ c - —à–∏—Ñ—Ä–æ—Ç–µ–∫—Å—Ç, m - –∏—Å—Ö–æ–¥–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</p>
                </div>
            </div>

            <h3>–ö—Ä–∏–ø—Ç–æ—Å—Ç–æ–π–∫–æ—Å—Ç—å:</h3>
            <ul>
                <li><strong>–î–ª–∏–Ω–∞ –∫–ª—é—á–∞:</strong> –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2048-4096 –±–∏—Ç</li>
                <li><strong>–û—Å–Ω–æ–≤–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:</strong> –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ñ–∞–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –±–æ–ª—å—à–∏—Ö —á–∏—Å–µ–ª</li>
                <li><strong>–£–≥—Ä–æ–∑—ã:</strong> –ö–≤–∞–Ω—Ç–æ–≤—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã (–∞–ª–≥–æ—Ä–∏—Ç–º –®–æ—Ä–∞)</li>
            </ul>

            <h3>–û–±–ª–∞—Å—Ç–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è:</h3>
            <div class="applications">
                <div class="application-item">üîê SSL/TLS —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã</div>
                <div class="application-item">üìß –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã (PGP)</div>
                <div class="application-item">üí≥ –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ –æ–Ω–ª–∞–π–Ω-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏</div>
                <div class="application-item">üì± –¶–∏—Ñ—Ä–æ–≤—ã–µ –ø–æ–¥–ø–∏—Å–∏</div>
                <div class="application-item">üåê VPN —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è</div>
            </div>
        </div>
    </div>

    <div class="demo-section">
        <h2>üõ†Ô∏è –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∞—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è RSA</h2>

        <div class="crypto-operations">
            <div class="operation-panel">
                <h3>üîë –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π</h3>
                <button onclick="generateRSAKeys()" class="btn btn-primary">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª—é—á–∏</button>
                <div class="key-display">
                    <div class="key-item">
                        <label>–ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á (e, n):</label>
                        <code id="rsa-public-key">-</code>
                    </div>
                    <div class="key-item">
                        <label>–ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–ª—é—á (d, n):</label>
                        <code id="rsa-private-key">-</code>
                    </div>
                </div>
            </div>

            <div class="operation-panel">
                <h3>üîí –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</h3>
                <div class="input-group">
                    <label>–°–æ–æ–±—â–µ–Ω–∏–µ (—á–∏—Å–ª–æ –¥–æ 1000):</label>
                    <input type="number" id="rsa-message" value="42" min="1" max="1000">
                    <button onclick="encryptRSA()" class="btn btn-primary">–ó–∞—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
                </div>
                <div class="result-display">
                    <div class="result-item">
                        <label>–ó–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</label>
                        <code id="rsa-ciphertext">-</code>
                    </div>
                </div>
            </div>

            <div class="operation-panel">
                <h3>üîì –î–µ—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ</h3>
                <button onclick="decryptRSA()" class="btn btn-success">–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞—Ç—å</button>
                <div class="result-item">
                    <label>–†–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:</label>
                    <code id="rsa-decrypted">-</code>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
async function generateRSAKeys() {
    const response = await fetch('/api/rsa/generate_keys', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'}
    });
    const data = await response.json();

    document.getElementById('rsa-public-key').textContent = `(${data.public_key[0]}, ${data.public_key[1]})`;
    document.getElementById('rsa-private-key').textContent = `(${data.private_key[0]}, ${data.private_key[1]})`;
}

async function encryptRSA() {
    const publicKey = document.getElementById('rsa-public-key').textContent;
    const message = document.getElementById('rsa-message').value;

    if (publicKey === '-') {
        alert('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏!');
        return;
    }

    const match = publicKey.match(/\((\d+), (\d+)\)/);
    const pubKey = [parseInt(match[1]), parseInt(match[2])];

    const response = await fetch('/api/rsa/encrypt', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            public_key: pubKey,
            message: parseInt(message)
        })
    });
    const data = await response.json();

    document.getElementById('rsa-ciphertext').textContent = data.encrypted;
}

async function decryptRSA() {
    const privateKey = document.getElementById('rsa-private-key').textContent;
    const ciphertext = document.getElementById('rsa-ciphertext').textContent;

    if (privateKey === '-' || ciphertext === '-') {
        alert('–°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –∫–ª—é—á–∏ –∏ –∑–∞—à–∏—Ñ—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ!');
        return;
    }

    const match = privateKey.match(/\((\d+), (\d+)\)/);
    const privKey = [parseInt(match[1]), parseInt(match[2])];

    const response = await fetch('/api/rsa/decrypt', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            private_key: privKey,
            ciphertext: parseInt(ciphertext)
        })
    });
    const data = await response.json();

    document.getElementById('rsa-decrypted').textContent = data.decrypted;
}

function clearRSA() {
    document.getElementById('rsa-public-key').textContent = '-';
    document.getElementById('rsa-private-key').textContent = '-';
    document.getElementById('rsa-ciphertext').textContent = '-';
    document.getElementById('rsa-decrypted').textContent = '-';
}
</script>
{% endblock %}